"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2076],{2076:(G,k,p)=>{p.r(k),p.d(k,{EditProductModule:()=>R});var I=p(6814),A=p(3057),f=p(5861),r=p(95),E=p(7394),Z=p(8162),e=p(6689),a=p(5548),T=p(4695),S=p(7942),U=p(5821);function q(o,u){if(1&o&&e._UZ(0,"img",25),2&o){const n=e.oxw();e.Q6J("src",n.imagePreview,e.LSH)}}function w(o,u){1&o&&e._UZ(0,"ion-icon",26)}function F(o,u){1&o&&(e.TgZ(0,"ion-note",27),e._uU(1," Product name is required and must be at least 3 characters "),e.qZA())}function D(o,u){1&o&&(e.TgZ(0,"ion-note",27),e._uU(1," Unit price must be a positive number "),e.qZA())}function z(o,u){1&o&&(e.TgZ(0,"ion-note",27),e._uU(1," Purchase price must be a positive number "),e.qZA())}function J(o,u){1&o&&(e.TgZ(0,"ion-note",27),e._uU(1," Bulk price must be a positive number "),e.qZA())}function N(o,u){1&o&&(e.TgZ(0,"ion-note",27),e._uU(1," Barcode is required "),e.qZA())}function Y(o,u){if(1&o&&(e.TgZ(0,"ion-select-option",28),e._uU(1),e.qZA()),2&o){const n=u.$implicit;e.Q6J("value",n.id),e.xp6(1),e.hij(" ",n.name," ")}}function B(o,u){1&o&&(e.TgZ(0,"ion-note",27),e._uU(1," Please select a category "),e.qZA())}function Q(o,u){1&o&&(e.TgZ(0,"ion-note",27),e._uU(1," Stock amount must be a positive number "),e.qZA())}const L=[{path:"",component:(()=>{class o{constructor(n,t,i,l,m,s,d,c){this.fb=n,this.loadingCtrl=t,this.toastCtrl=i,this._user=l,this._product=m,this.navCtrl=s,this._global=d,this.actionSheetController=c,this.imagePreview=null,this.subscriptions=new E.w0,this.categories=[],this.MAX_FILE_SIZE=47185920,this.categories=this._product.getCategories()}ngOnInit(){const n=this._product.getItemData();this.itemData=n,console.log(this.itemData),this.formSetUp(),this.imagePreview=this.itemData.image1}formSetUp(){this.productForm=this.fb.group({name:[this.itemData.name,[r.kI.required,r.kI.minLength(3),r.kI.maxLength(100)]],unitPrice:[this.itemData.unitPrice||this.itemData.price||0,[r.kI.required,r.kI.min(0),r.kI.pattern(/^\d+(\.\d{1,2})?$/)]],purchasePrice:[this.itemData.purchasePrice||0,[r.kI.required,r.kI.min(0),r.kI.pattern(/^\d+(\.\d{1,2})?$/)]],bulkPrice:[this.itemData.bulkPrice||0,[r.kI.min(0),r.kI.pattern(/^\d+(\.\d{1,2})?$/)]],barcode:[this.itemData.barcode,[r.kI.required,r.kI.maxLength(50)]],categoryId:[this.itemData.category||"",[r.kI.required]],stockAmount:[this.itemData.stockAmount||0,[r.kI.required,r.kI.min(0),r.kI.pattern(/^\d+$/)]],image:[this.itemData.image1||"",""]})}presentImageSourceActionSheet(){var n=this;return(0,f.Z)(function*(){yield(yield n.actionSheetController.create({header:"Select Image Source",buttons:[{text:"Camera",icon:"camera",handler:()=>{n.takePicture(Z.oK.Camera)}},{text:"File",icon:"folder",handler:()=>{const i=document.querySelector('input[type="file"]');i&&i.click()}},{text:"Cancel",icon:"close",role:"cancel"}]})).present()})()}takePicture(n){var t=this;return(0,f.Z)(function*(){try{const i=yield Z.V1.getPhoto({quality:90,allowEditing:!1,resultType:Z.dk.Base64,source:n,correctOrientation:!0,width:500,height:500});if(i.base64String){const l=`data:image/jpeg;base64,${i.base64String}`;if(t.getBase64Size(l)>t.MAX_FILE_SIZE)return void(yield(yield t.toastCtrl.create({message:"Image size must be less than or equal to 45MB.",duration:2e3,color:"danger"})).present());try{const s=yield t.compressImage(l);t.imagePreview=s,t.productForm.patchValue({image:s})}catch{yield(yield t.toastCtrl.create({message:"Failed to process image. Please try another image.",duration:2e3,color:"danger"})).present()}}}catch(i){console.error("Error taking picture",i),yield(yield t.toastCtrl.create({message:"Failed to get image. Please try again.",duration:2e3,color:"danger"})).present()}})()}getBase64Size(n){const t=n.split(",")[1];return t?Math.ceil(3*t.length/4):0}getFileSize(n){return n.size}compressImage(n,t=700){var i=this;return(0,f.Z)(function*(){return i._global.setLoader(!0),new Promise((l,m)=>{let s,d=new Image;"string"==typeof n?d.src=n:(s=new FileReader,s.readAsDataURL(n),s.onload=c=>{var g;d.src=null===(g=c.target)||void 0===g?void 0:g.result},s.onerror=c=>m(c)),d.onload=()=>{const c=document.createElement("canvas"),g=c.getContext("2d");let b,h=.9,P=1;const v=()=>{if(c.width=d.width*P,c.height=d.height*P,null==g||g.drawImage(d,0,0,c.width,c.height),b=c.toDataURL("image/jpeg",h),b.length*(3/4)/1024>t){if(h>.1)h-=.1;else{if(!(P>.5))return void m(new Error("Cannot compress image to required size"));P-=.1,h=.9}v()}else l(b)};v(),i._global.setLoader(!1)},d.onerror=c=>m(c)})})()}onImageSelect(n){var t=this;return(0,f.Z)(function*(){const i=n.target.files[0];if(i){if(t.getFileSize(i)>t.MAX_FILE_SIZE)return void(yield(yield t.toastCtrl.create({message:"Image size must be less than or equal to 45MB.",duration:2e3,color:"danger"})).present());try{const l=yield t.compressImage(i);t.imagePreview=l,t.productForm.patchValue({image:l})}catch{yield(yield t.toastCtrl.create({message:"Failed to compress image. Please try another image.",duration:2e3,color:"danger"})).present()}}})()}onSubmit(){var n=this;return(0,f.Z)(function*(){if(!n.productForm.valid)return n.markFormGroupTouched(),void(yield(yield n.toastCtrl.create({message:"Please fill in all required fields correctly.",duration:2e3,color:"warning"})).present());const t=yield n.loadingCtrl.create({message:"Updating product..."});yield t.present();try{var i,l,m,s,d,c,g,h,P,b,v,y,x,M;const C={id:n.itemData.id,name:null===(i=n.productForm.get("name"))||void 0===i||null===(l=i.value)||void 0===l?void 0:l.trim(),unitPrice:parseFloat(null===(m=n.productForm.get("unitPrice"))||void 0===m?void 0:m.value)||0,image:(null===(s=n.productForm.get("image"))||void 0===s?void 0:s.value)||"",createdDate:n.itemData.createdDate,lastUpdatedDate:(new Date).toISOString(),categoryId:parseInt(null===(d=n.productForm.get("categoryId"))||void 0===d?void 0:d.value),stockAmount:parseInt(null===(c=n.productForm.get("stockAmount"))||void 0===c?void 0:c.value)||0,barcode:null===(g=n.productForm.get("barcode"))||void 0===g||null===(h=g.value)||void 0===h?void 0:h.trim(),shortDescription:null===(P=n.productForm.get("shortDescription"))||void 0===P||null===(b=P.value)||void 0===b?void 0:b.trim(),longDescription:(null===(v=n.productForm.get("longDescription"))||void 0===v||null===(y=v.value)||void 0===y?void 0:y.trim())||"",purchasePrice:parseFloat(null===(x=n.productForm.get("purchasePrice"))||void 0===x?void 0:x.value)||0,bulkPrice:parseFloat(null===(M=n.productForm.get("bulkPrice"))||void 0===M?void 0:M.value)||0};console.log("Form Data:",n.productForm.value),console.log("Processed Data:",C),n._user.geteditproduct(C).subscribe(function(){var O=(0,f.Z)(function*(_){console.log("API Response:",_),yield t.dismiss(),n.handleSuccess()});return function(_){return O.apply(this,arguments)}}(),function(){var O=(0,f.Z)(function*(_){console.error("API error:",_),yield t.dismiss(),n.handleError("Failed to update product. Please try again.")});return function(_){return O.apply(this,arguments)}}())}catch(C){console.error("Unexpected error:",C),yield t.dismiss(),n.handleError("An unexpected error occurred. Please try again.")}})()}handleSuccess(){var n=this;return(0,f.Z)(function*(){yield(yield n.toastCtrl.create({message:"Product updated successfully!",duration:2e3,color:"success"})).present(),setTimeout(()=>{n.navCtrl.navigateForward("/product")},2e3)})()}handleError(n){var t=this;return(0,f.Z)(function*(){yield(yield t.toastCtrl.create({message:n,duration:3e3,color:"danger"})).present()})()}markFormGroupTouched(){Object.keys(this.productForm.controls).forEach(n=>{const t=this.productForm.get(n);null==t||t.markAsTouched()})}isFieldInvalid(n){const t=this.productForm.get(n);return!!t&&t.invalid&&t.touched}getFieldErrorMessage(n){const t=this.productForm.get(n);return t&&t.errors?t.errors.required?"This field is required":t.errors.minlength?`Minimum length is ${t.errors.minlength.requiredLength} characters`:t.errors.maxlength?`Maximum length is ${t.errors.maxlength.requiredLength} characters`:t.errors.min?`Minimum value is ${t.errors.min.min}`:t.errors.pattern?"Invalid format":"Invalid input":""}}return o.\u0275fac=function(n){return new(n||o)(e.Y36(r.qu),e.Y36(a.HT),e.Y36(a.yF),e.Y36(T.K),e.Y36(S.M),e.Y36(a.SH),e.Y36(U.U),e.Y36(a.BX))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-edit-product"]],decls:59,vars:15,consts:[["slot","start"],["defaultHref","/products"],[2,"display","flex"],[1,"balaanz-logo"],["src","/assets/images/balaanz-logo.jpg"],[1,"ion-padding",3,"formGroup","ngSubmit"],[1,"image-upload-container"],[1,"image-preview"],[3,"src",4,"ngIf"],["name","image-outline",4,"ngIf"],["type","file","accept","image/*","hidden","",3,"change"],["fileInput",""],["fill","clear","expand","block",3,"click"],["position","stacked"],["formControlName","name","placeholder","Enter product name"],["slot","error",4,"ngIf"],["type","number","formControlName","unitPrice","placeholder","Enter unit price","min","0","step","0.01"],["type","number","formControlName","purchasePrice","placeholder","Enter purchase price","min","0","step","0.01"],["type","number","formControlName","bulkPrice","placeholder","Enter bulk price","min","0","step","0.01"],["formControlName","barcode","placeholder","Enter barcode"],["formControlName","categoryId","placeholder","Select category"],[3,"value",4,"ngFor","ngForOf"],["type","number","formControlName","stockAmount","placeholder","Enter stock amount","min","0"],[1,"submit-button"],["expand","block","type","submit",3,"disabled"],[3,"src"],["name","image-outline"],["slot","error"],[3,"value"]],template:function(n,t){if(1&n&&(e.TgZ(0,"div")(1,"ion-toolbar")(2,"ion-buttons",0),e._UZ(3,"ion-back-button",1),e.qZA(),e.TgZ(4,"div",2)(5,"ion-title"),e._uU(6,"Edit Product"),e.qZA(),e.TgZ(7,"span",3),e._UZ(8,"img",4),e.qZA()()()(),e.TgZ(9,"ion-content")(10,"form",5),e.NdJ("ngSubmit",function(){return t.onSubmit()}),e.TgZ(11,"div",6)(12,"div",7),e.YNc(13,q,1,1,"img",8),e.YNc(14,w,1,0,"ion-icon",9),e.TgZ(15,"input",10,11),e.NdJ("change",function(l){return t.onImageSelect(l)}),e.qZA(),e.TgZ(17,"ion-button",12),e.NdJ("click",function(){return t.presentImageSourceActionSheet()}),e._uU(18),e.qZA()()(),e.TgZ(19,"ion-list")(20,"ion-item")(21,"ion-label",13),e._uU(22,"Product Name"),e.qZA(),e._UZ(23,"ion-input",14),e.YNc(24,F,2,0,"ion-note",15),e.qZA(),e.TgZ(25,"ion-item")(26,"ion-label",13),e._uU(27,"Unit Price"),e.qZA(),e._UZ(28,"ion-input",16),e.YNc(29,D,2,0,"ion-note",15),e.qZA(),e.TgZ(30,"ion-item")(31,"ion-label",13),e._uU(32,"Purchase Price"),e.qZA(),e._UZ(33,"ion-input",17),e.YNc(34,z,2,0,"ion-note",15),e.qZA(),e.TgZ(35,"ion-item")(36,"ion-label",13),e._uU(37,"Bulk Price"),e.qZA(),e._UZ(38,"ion-input",18),e.YNc(39,J,2,0,"ion-note",15),e.qZA(),e.TgZ(40,"ion-item")(41,"ion-label",13),e._uU(42,"Barcode"),e.qZA(),e._UZ(43,"ion-input",19),e.YNc(44,N,2,0,"ion-note",15),e.qZA(),e.TgZ(45,"ion-item")(46,"ion-label",13),e._uU(47,"Category"),e.qZA(),e.TgZ(48,"ion-select",20),e.YNc(49,Y,2,2,"ion-select-option",21),e.qZA(),e.YNc(50,B,2,0,"ion-note",15),e.qZA(),e.TgZ(51,"ion-item")(52,"ion-label",13),e._uU(53,"Stock Amount"),e.qZA(),e._UZ(54,"ion-input",22),e.YNc(55,Q,2,0,"ion-note",15),e.qZA()(),e.TgZ(56,"div",23)(57,"ion-button",24),e._uU(58," Update Product "),e.qZA()()()()),2&n){let i,l,m,s,d,c,g;e.xp6(10),e.Q6J("formGroup",t.productForm),e.xp6(2),e.ekj("has-image",t.imagePreview),e.xp6(1),e.Q6J("ngIf",t.imagePreview),e.xp6(1),e.Q6J("ngIf",!t.imagePreview),e.xp6(4),e.hij(" ",t.imagePreview?"Change Image":"Upload Image"," "),e.xp6(6),e.Q6J("ngIf",(null==(i=t.productForm.get("name"))?null:i.invalid)&&(null==(i=t.productForm.get("name"))?null:i.touched)),e.xp6(5),e.Q6J("ngIf",(null==(l=t.productForm.get("unitPrice"))?null:l.invalid)&&(null==(l=t.productForm.get("unitPrice"))?null:l.touched)),e.xp6(5),e.Q6J("ngIf",(null==(m=t.productForm.get("purchasePrice"))?null:m.invalid)&&(null==(m=t.productForm.get("purchasePrice"))?null:m.touched)),e.xp6(5),e.Q6J("ngIf",(null==(s=t.productForm.get("bulkPrice"))?null:s.invalid)&&(null==(s=t.productForm.get("bulkPrice"))?null:s.touched)),e.xp6(5),e.Q6J("ngIf",(null==(d=t.productForm.get("barcode"))?null:d.invalid)&&(null==(d=t.productForm.get("barcode"))?null:d.touched)),e.xp6(5),e.Q6J("ngForOf",t.categories),e.xp6(1),e.Q6J("ngIf",(null==(c=t.productForm.get("categoryId"))?null:c.invalid)&&(null==(c=t.productForm.get("categoryId"))?null:c.touched)),e.xp6(5),e.Q6J("ngIf",(null==(g=t.productForm.get("stockAmount"))?null:g.invalid)&&(null==(g=t.productForm.get("stockAmount"))?null:g.touched)),e.xp6(2),e.Q6J("disabled",!t.productForm.valid)}},dependencies:[I.sg,I.O5,a.oU,a.YG,a.Sm,a.W2,a.gu,a.pK,a.Ie,a.Q$,a.q_,a.uN,a.t9,a.n0,a.wd,a.sr,a.as,a.QI,a.j9,a.cs,r._Y,r.JJ,r.JL,r.sg,r.u],styles:['.balaanz-logo[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;align-items:center;height:30px}.balaanz-logo[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:40px;width:40px;border-radius:80%;object-fit:cover;margin-right:10px}.image-upload-container[_ngcontent-%COMP%]{display:flex;justify-content:center;margin-bottom:20px}.image-preview[_ngcontent-%COMP%]{width:200px;height:200px;border:2px dashed #ccc;border-radius:8px;display:flex;flex-direction:column;align-items:center;justify-content:center;position:relative;background-color:#f8f9fa;transition:border-color .3s ease}.image-preview.has-image[_ngcontent-%COMP%]{border-color:#3880ff;background-color:#fff}.image-preview[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;border-radius:6px}.image-preview[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:48px;color:#999;margin-bottom:10px}.image-preview[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{margin-top:10px;--color: #3880ff;--border-color: #3880ff}ion-list[_ngcontent-%COMP%]{margin-bottom:20px}ion-item[_ngcontent-%COMP%]{--padding-start: 0;--padding-end: 0;--inner-padding-end: 0;margin-bottom:16px;border-radius:8px;--border-radius: 8px;--background: #f8f9fa;--border-color: #e9ecef}ion-item.item-has-focus[_ngcontent-%COMP%]{--background: #fff;--border-color: #3880ff;box-shadow:0 0 0 2px #3880ff33}ion-item.item-has-error[_ngcontent-%COMP%]{--border-color: #eb445a;--background: #fff5f5}ion-label[_ngcontent-%COMP%]{font-weight:600;color:#2c3e50;margin-bottom:8px}ion-input[_ngcontent-%COMP%], ion-select[_ngcontent-%COMP%], ion-textarea[_ngcontent-%COMP%]{--padding-start: 12px;--padding-end: 12px;--padding-top: 12px;--padding-bottom: 12px;--background: #fff;--border-radius: 6px;--border: 1px solid #e9ecef;margin-top:8px}ion-input.ion-invalid[_ngcontent-%COMP%], ion-select.ion-invalid[_ngcontent-%COMP%], ion-textarea.ion-invalid[_ngcontent-%COMP%]{--border-color: #eb445a}ion-input.ion-valid[_ngcontent-%COMP%], ion-select.ion-valid[_ngcontent-%COMP%], ion-textarea.ion-valid[_ngcontent-%COMP%]{--border-color: #2dd36f}ion-textarea[_ngcontent-%COMP%]{--min-height: 80px;--max-height: 120px}ion-note[_ngcontent-%COMP%]{font-size:12px;margin-top:4px}ion-note[slot=error][_ngcontent-%COMP%]{color:#eb445a;font-weight:500}ion-note[slot=helper][_ngcontent-%COMP%]{color:#6c757d;font-style:italic}.submit-button[_ngcontent-%COMP%]{margin-top:30px;margin-bottom:20px}.submit-button[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{--border-radius: 8px;--padding-top: 16px;--padding-bottom: 16px;font-weight:600;font-size:16px}.submit-button[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]:disabled{--opacity: .6}@media (max-width: 576px){.image-preview[_ngcontent-%COMP%]{width:150px;height:150px}ion-item[_ngcontent-%COMP%]{margin-bottom:12px}.submit-button[_ngcontent-%COMP%]{margin-top:20px}}.form-error[_ngcontent-%COMP%]{color:#eb445a;font-size:12px;margin-top:4px;font-weight:500}.form-helper[_ngcontent-%COMP%]{color:#6c757d;font-size:12px;margin-top:4px;font-style:italic}ion-item[_ngcontent-%COMP%]:nth-child(2)   ion-label[_ngcontent-%COMP%]:after, ion-item[_ngcontent-%COMP%]:nth-child(3)   ion-label[_ngcontent-%COMP%]:after, ion-item[_ngcontent-%COMP%]:nth-child(4)   ion-label[_ngcontent-%COMP%]:after, ion-item[_ngcontent-%COMP%]:nth-child(6)   ion-label[_ngcontent-%COMP%]:after, ion-item[_ngcontent-%COMP%]:nth-child(7)   ion-label[_ngcontent-%COMP%]:after, ion-item[_ngcontent-%COMP%]:nth-child(8)   ion-label[_ngcontent-%COMP%]:after, ion-item[_ngcontent-%COMP%]:nth-child(9)   ion-label[_ngcontent-%COMP%]:after{content:" *";color:#eb445a;font-weight:700}']}),o})()}];let j=(()=>{class o{}return o.\u0275fac=function(n){return new(n||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[A.Bz.forChild(L),A.Bz]}),o})(),R=(()=>{class o{}return o.\u0275fac=function(n){return new(n||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[I.ez,j,a.Pc,r.UX]}),o})()}}]);