"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[679],{679:(B,A,m)=>{m.r(A),m.d(A,{AddNewProductModule:()=>Y});var _=m(6814),I=m(3057),b=m(5861),c=m(95),w=m(7394),x=m(8162),e=m(6689),r=m(5548),O=m(4695),Z=m(7942),S=m(5821);function N(o,u){if(1&o&&e._UZ(0,"img",23),2&o){const n=e.oxw();e.Q6J("src",n.imagePreview,e.LSH)}}function T(o,u){1&o&&e._UZ(0,"ion-icon",24)}function k(o,u){1&o&&(e.TgZ(0,"ion-note",25),e._uU(1," Product name is required and must be at least 3 characters "),e.qZA())}function F(o,u){1&o&&(e.TgZ(0,"ion-note",25),e._uU(1," Unit price must be a positive number "),e.qZA())}function U(o,u){if(1&o&&(e.TgZ(0,"ion-select-option",26),e._uU(1),e.qZA()),2&o){const n=u.$implicit;e.Q6J("value",n.id),e.xp6(1),e.hij(" ",n.name," ")}}function z(o,u){1&o&&(e.TgZ(0,"ion-note",25),e._uU(1," Please select a category "),e.qZA())}function q(o,u){1&o&&(e.TgZ(0,"ion-note",25),e._uU(1," Stock amount must be a positive number "),e.qZA())}const E=[{path:"",component:(()=>{class o{constructor(n,t,i,a,s,l,g,d){this.fb=n,this.loadingCtrl=t,this.toastCtrl=i,this._user=a,this.navCtrl=s,this._product=l,this._global=g,this.actionSheetController=d,this.imagePreview=null,this.subscriptions=new w.w0,this.categories=[],this.MAX_FILE_SIZE=47185920,this.initializeForm(),this.categories=this._product.getCategories()}initializeForm(){this.productForm=this.fb.group({name:["",[c.kI.required,c.kI.minLength(3),c.kI.maxLength(100)]],unitPrice:[0,[c.kI.required,c.kI.min(0),c.kI.pattern(/^\d+(\.\d{1,2})?$/)]],barcode:["",[c.kI.maxLength(50)]],categoryId:["",[c.kI.required]],image:[""],stockAmount:[0,[c.kI.required,c.kI.min(0),c.kI.pattern(/^\d+$/)]]})}presentImageSourceActionSheet(){var n=this;return(0,b.Z)(function*(){yield(yield n.actionSheetController.create({header:"Select Image Source",buttons:[{text:"Camera",icon:"camera",handler:()=>{n.takePicture(x.oK.Camera)}},{text:"File",icon:"folder",handler:()=>{const i=document.querySelector('input[type="file"]');i&&i.click()}},{text:"Cancel",icon:"close",role:"cancel"}]})).present()})()}takePicture(n){var t=this;return(0,b.Z)(function*(){try{const i=yield x.V1.getPhoto({quality:90,allowEditing:!1,resultType:x.dk.Base64,source:n,correctOrientation:!0,width:500,height:500});if(i.base64String){const a=`data:image/jpeg;base64,${i.base64String}`;if(t.getBase64Size(a)>t.MAX_FILE_SIZE)return void(yield(yield t.toastCtrl.create({message:"Image size must be less than or equal to 45MB.",duration:2e3,color:"danger"})).present());try{const l=yield t.compressImage(a);t.imagePreview=l,t.productForm.patchValue({image:l})}catch{yield(yield t.toastCtrl.create({message:"Failed to process image. Please try another image.",duration:2e3,color:"danger"})).present()}}}catch(i){console.error("Error taking picture",i),yield(yield t.toastCtrl.create({message:"Failed to get image. Please try again.",duration:2e3,color:"danger"})).present()}})()}getBase64Size(n){const t=n.split(",")[1];return t?Math.ceil(3*t.length/4):0}getFileSize(n){return n.size}compressImage(n,t=700){var i=this;return(0,b.Z)(function*(){return i._global.setLoader(!0),new Promise((a,s)=>{let l,g=new Image;"string"==typeof n?g.src=n:(l=new FileReader,l.readAsDataURL(n),l.onload=d=>{var p;g.src=null===(p=d.target)||void 0===p?void 0:p.result},l.onerror=d=>s(d)),g.onload=()=>{const d=document.createElement("canvas"),p=d.getContext("2d");let v,f=.9,h=1;const P=()=>{if(d.width=g.width*h,d.height=g.height*h,null==p||p.drawImage(g,0,0,d.width,d.height),v=d.toDataURL("image/jpeg",f),v.length*(3/4)/1024>t){if(f>.1)f-=.1;else{if(!(h>.5))return void s(new Error("Cannot compress image to required size"));h-=.1,f=.9}P()}else a(v)};P(),i._global.setLoader(!1)},g.onerror=d=>s(d)})})()}onImageSelect(n){var t=this;return(0,b.Z)(function*(){const i=n.target.files[0];if(i){if(t.getFileSize(i)>t.MAX_FILE_SIZE)return void(yield(yield t.toastCtrl.create({message:"Image size must be less than or equal to 45MB.",duration:2e3,color:"danger"})).present());try{const a=yield t.compressImage(i);t.imagePreview=a,t.productForm.patchValue({image:a})}catch{yield(yield t.toastCtrl.create({message:"Failed to compress image. Please try another image.",duration:2e3,color:"danger"})).present()}}})()}onSubmit(){var n=this;return(0,b.Z)(function*(){if(n.productForm.valid){const y=yield n.loadingCtrl.create({message:"Adding product..."});yield y.present();try{var t,i,a,s,l,g,d,p,f,h,v,P;const C={name:null===(t=n.productForm.get("name"))||void 0===t||null===(i=t.value)||void 0===i?void 0:i.trim(),unitPrice:parseFloat(null===(a=n.productForm.get("unitPrice"))||void 0===a?void 0:a.value)||0,barcode:(null===(s=n.productForm.get("barcode"))||void 0===s||null===(l=s.value)||void 0===l?void 0:l.trim())||"",categoryId:parseInt(null===(g=n.productForm.get("categoryId"))||void 0===g?void 0:g.value),image:(null===(d=n.productForm.get("image"))||void 0===d?void 0:d.value)||"",stockAmount:parseInt(null===(p=n.productForm.get("stockAmount"))||void 0===p?void 0:p.value)||0,shortDescription:null===(f=n.productForm.get("shortDescription"))||void 0===f||null===(h=f.value)||void 0===h?void 0:h.trim(),longDescription:(null===(v=n.productForm.get("longDescription"))||void 0===v||null===(P=v.value)||void 0===P?void 0:P.trim())||"",createdDate:(new Date).toISOString(),lastUpdatedDate:(new Date).toISOString()};console.log("Form Data:",n.productForm.value),console.log("Processed Data:",C);const D=n._user.getnewproductadd(C).subscribe(M=>{console.log("API Response:",M),n.handleSuccess()},M=>{console.error("API Error:",M),n.handleError("Failed to add product. Please try again.")});n.subscriptions.add(D),yield y.dismiss()}catch(C){console.error("Unexpected Error:",C),yield y.dismiss(),n.handleError("An unexpected error occurred. Please try again.")}}else n.markFormGroupTouched(),n.handleError("Please fill in all required fields correctly.")})()}handleSuccess(){var n=this;return(0,b.Z)(function*(){yield(yield n.toastCtrl.create({message:"Product added successfully!",duration:2e3,color:"success"})).present(),setTimeout(()=>{n.navCtrl.navigateForward("/product")},2e3),n.resetForm()})()}handleError(n){var t=this;return(0,b.Z)(function*(){yield(yield t.toastCtrl.create({message:n,duration:3e3,color:"danger"})).present()})()}markFormGroupTouched(){Object.keys(this.productForm.controls).forEach(n=>{const t=this.productForm.get(n);null==t||t.markAsTouched()})}resetForm(){this.productForm.reset(),this.imagePreview=null,this.initializeForm()}isFieldInvalid(n){const t=this.productForm.get(n);return!!t&&t.invalid&&t.touched}getFieldErrorMessage(n){const t=this.productForm.get(n);return t&&t.errors?t.errors.required?"This field is required":t.errors.minlength?`Minimum length is ${t.errors.minlength.requiredLength} characters`:t.errors.maxlength?`Maximum length is ${t.errors.maxlength.requiredLength} characters`:t.errors.min?`Minimum value is ${t.errors.min.min}`:t.errors.pattern?"Invalid format":"Invalid input":""}}return o.\u0275fac=function(n){return new(n||o)(e.Y36(c.qu),e.Y36(r.HT),e.Y36(r.yF),e.Y36(O.K),e.Y36(r.SH),e.Y36(Z.M),e.Y36(S.U),e.Y36(r.BX))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-add-new-product"]],decls:48,vars:12,consts:[["slot","start"],["defaultHref","/products"],[2,"display","flex"],[1,"balaanz-logo"],["src","/assets/images/balaanz-logo.jpg"],[1,"ion-padding",3,"formGroup","ngSubmit"],[1,"image-upload-container"],[1,"image-preview"],[3,"src",4,"ngIf"],["name","image-outline",4,"ngIf"],["type","file","accept","image/*","hidden","",3,"change"],["fileInput",""],["fill","clear","expand","block",3,"click"],["position","stacked"],["formControlName","name","placeholder","Enter product name"],["slot","error",4,"ngIf"],["type","number","formControlName","unitPrice","placeholder","Enter unit price","min","0","step","0.01"],["formControlName","barcode","placeholder","Enter barcode"],["formControlName","categoryId","placeholder","Select category"],[3,"value",4,"ngFor","ngForOf"],["type","number","formControlName","stockAmount","placeholder","Enter stock amount","min","0"],[1,"submit-button"],["expand","block","type","submit",3,"disabled"],[3,"src"],["name","image-outline"],["slot","error"],[3,"value"]],template:function(n,t){if(1&n&&(e.TgZ(0,"div")(1,"ion-toolbar")(2,"ion-buttons",0),e._UZ(3,"ion-back-button",1),e.qZA(),e.TgZ(4,"div",2)(5,"ion-title"),e._uU(6,"Add New Product"),e.qZA(),e.TgZ(7,"span",3),e._UZ(8,"img",4),e.qZA()()()(),e.TgZ(9,"ion-content")(10,"form",5),e.NdJ("ngSubmit",function(){return t.onSubmit()}),e.TgZ(11,"div",6)(12,"div",7),e.YNc(13,N,1,1,"img",8),e.YNc(14,T,1,0,"ion-icon",9),e.TgZ(15,"input",10,11),e.NdJ("change",function(a){return t.onImageSelect(a)}),e.qZA(),e.TgZ(17,"ion-button",12),e.NdJ("click",function(){return t.presentImageSourceActionSheet()}),e._uU(18),e.qZA()()(),e.TgZ(19,"ion-list")(20,"ion-item")(21,"ion-label",13),e._uU(22,"Product Name"),e.qZA(),e._UZ(23,"ion-input",14),e.YNc(24,k,2,0,"ion-note",15),e.qZA(),e.TgZ(25,"ion-item")(26,"ion-label",13),e._uU(27,"Unit Price"),e.qZA(),e._UZ(28,"ion-input",16),e.YNc(29,F,2,0,"ion-note",15),e.qZA(),e.TgZ(30,"ion-item")(31,"ion-label",13),e._uU(32,"Barcode"),e.qZA(),e._UZ(33,"ion-input",17),e.qZA(),e.TgZ(34,"ion-item")(35,"ion-label",13),e._uU(36,"Category"),e.qZA(),e.TgZ(37,"ion-select",18),e.YNc(38,U,2,2,"ion-select-option",19),e.qZA(),e.YNc(39,z,2,0,"ion-note",15),e.qZA(),e.TgZ(40,"ion-item")(41,"ion-label",13),e._uU(42,"Stock Amount"),e.qZA(),e._UZ(43,"ion-input",20),e.YNc(44,q,2,0,"ion-note",15),e.qZA()(),e.TgZ(45,"div",21)(46,"ion-button",22),e._uU(47," Add Product "),e.qZA()()()()),2&n){let i,a,s,l;e.xp6(10),e.Q6J("formGroup",t.productForm),e.xp6(2),e.ekj("has-image",t.imagePreview),e.xp6(1),e.Q6J("ngIf",t.imagePreview),e.xp6(1),e.Q6J("ngIf",!t.imagePreview),e.xp6(4),e.hij(" ",t.imagePreview?"Change Image":"Upload Image"," "),e.xp6(6),e.Q6J("ngIf",(null==(i=t.productForm.get("name"))?null:i.invalid)&&(null==(i=t.productForm.get("name"))?null:i.touched)),e.xp6(5),e.Q6J("ngIf",(null==(a=t.productForm.get("unitPrice"))?null:a.invalid)&&(null==(a=t.productForm.get("unitPrice"))?null:a.touched)),e.xp6(9),e.Q6J("ngForOf",t.categories),e.xp6(1),e.Q6J("ngIf",(null==(s=t.productForm.get("categoryId"))?null:s.invalid)&&(null==(s=t.productForm.get("categoryId"))?null:s.touched)),e.xp6(5),e.Q6J("ngIf",(null==(l=t.productForm.get("stockAmount"))?null:l.invalid)&&(null==(l=t.productForm.get("stockAmount"))?null:l.touched)),e.xp6(2),e.Q6J("disabled",!t.productForm.valid)}},dependencies:[_.sg,_.O5,r.oU,r.YG,r.Sm,r.W2,r.gu,r.pK,r.Ie,r.Q$,r.q_,r.uN,r.t9,r.n0,r.wd,r.sr,r.as,r.QI,r.j9,r.cs,c._Y,c.JJ,c.JL,c.sg,c.u],styles:['.balaanz-logo[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;align-items:center;height:30px}.balaanz-logo[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:40px;width:40px;border-radius:80%;object-fit:cover;margin-left:10px}.image-upload-container[_ngcontent-%COMP%]{display:flex;justify-content:center;margin-bottom:20px}.image-preview[_ngcontent-%COMP%]{width:200px;height:200px;border:2px dashed #ccc;border-radius:8px;display:flex;flex-direction:column;align-items:center;justify-content:center;position:relative;background-color:#f8f9fa;transition:border-color .3s ease}.image-preview.has-image[_ngcontent-%COMP%]{border-color:#3880ff;background-color:#fff}.image-preview[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;border-radius:6px}.image-preview[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:48px;color:#999;margin-bottom:10px}.image-preview[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{margin-top:10px;--color: #3880ff;--border-color: #3880ff}ion-list[_ngcontent-%COMP%]{margin-bottom:20px}ion-item[_ngcontent-%COMP%]{--padding-start: 0;--padding-end: 0;--inner-padding-end: 0;margin-bottom:16px;border-radius:8px;--border-radius: 8px;--background: #f8f9fa;--border-color: #e9ecef}ion-item.item-has-focus[_ngcontent-%COMP%]{--background: #fff;--border-color: #3880ff;box-shadow:0 0 0 2px #3880ff33}ion-item.item-has-error[_ngcontent-%COMP%]{--border-color: #eb445a;--background: #fff5f5}ion-label[_ngcontent-%COMP%]{font-weight:600;color:#2c3e50;margin-bottom:8px}ion-input[_ngcontent-%COMP%], ion-select[_ngcontent-%COMP%], ion-textarea[_ngcontent-%COMP%]{--padding-start: 12px;--padding-end: 12px;--padding-top: 12px;--padding-bottom: 12px;--background: #fff;--border-radius: 6px;--border: 1px solid #e9ecef;margin-top:8px}ion-input.ion-invalid[_ngcontent-%COMP%], ion-select.ion-invalid[_ngcontent-%COMP%], ion-textarea.ion-invalid[_ngcontent-%COMP%]{--border-color: #eb445a}ion-input.ion-valid[_ngcontent-%COMP%], ion-select.ion-valid[_ngcontent-%COMP%], ion-textarea.ion-valid[_ngcontent-%COMP%]{--border-color: #2dd36f}ion-textarea[_ngcontent-%COMP%]{--min-height: 80px;--max-height: 120px}ion-note[_ngcontent-%COMP%]{font-size:12px;margin-top:4px}ion-note[slot=error][_ngcontent-%COMP%]{color:#eb445a;font-weight:500}ion-note[slot=helper][_ngcontent-%COMP%]{color:#6c757d;font-style:italic}.submit-button[_ngcontent-%COMP%]{margin-top:30px;margin-bottom:20px}.submit-button[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{--border-radius: 8px;--padding-top: 16px;--padding-bottom: 16px;font-weight:600;font-size:16px}.submit-button[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]:disabled{--opacity: .6}@media (max-width: 576px){.image-preview[_ngcontent-%COMP%]{width:150px;height:150px}ion-item[_ngcontent-%COMP%]{margin-bottom:12px}.submit-button[_ngcontent-%COMP%]{margin-top:20px}}.form-error[_ngcontent-%COMP%]{color:#eb445a;font-size:12px;margin-top:4px;font-weight:500}.form-helper[_ngcontent-%COMP%]{color:#6c757d;font-size:12px;margin-top:4px;font-style:italic}ion-label[for=name][_ngcontent-%COMP%]:after, ion-label[for=unitPrice][_ngcontent-%COMP%]:after, ion-label[for=categoryId][_ngcontent-%COMP%]:after, ion-label[for=stockAmount][_ngcontent-%COMP%]:after, ion-label[for=shortDescription][_ngcontent-%COMP%]:after{content:" *";color:#eb445a;font-weight:700}ion-item[_ngcontent-%COMP%]:nth-child(2)   ion-label[_ngcontent-%COMP%]:after, ion-item[_ngcontent-%COMP%]:nth-child(3)   ion-label[_ngcontent-%COMP%]:after, ion-item[_ngcontent-%COMP%]:nth-child(5)   ion-label[_ngcontent-%COMP%]:after, ion-item[_ngcontent-%COMP%]:nth-child(6)   ion-label[_ngcontent-%COMP%]:after, ion-item[_ngcontent-%COMP%]:nth-child(7)   ion-label[_ngcontent-%COMP%]:after{content:" *";color:#eb445a;font-weight:700}']}),o})()}];let J=(()=>{class o{}return o.\u0275fac=function(n){return new(n||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[I.Bz.forChild(E),I.Bz]}),o})(),Y=(()=>{class o{}return o.\u0275fac=function(n){return new(n||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[_.ez,J,r.Pc,c.UX]}),o})()}}]);