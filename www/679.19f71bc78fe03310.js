"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[679],{679:(D,M,g)=>{g.r(M),g.d(M,{AddNewProductModule:()=>Y});var x=g(6814),w=g(3057),v=g(5861),m=g(95),I=g(7394),_=g(8162),e=g(6689),i=g(5548),Z=g(4695),O=g(7942),S=g(5821);function N(n,s){if(1&n&&e._UZ(0,"img",23),2&n){const o=e.oxw();e.Q6J("src",o.imagePreview,e.LSH)}}function T(n,s){1&n&&e._UZ(0,"ion-icon",24)}function F(n,s){1&n&&(e.TgZ(0,"ion-note",25),e._uU(1," Product name is required and must be at least 3 characters "),e.qZA())}function k(n,s){1&n&&(e.TgZ(0,"ion-note",25),e._uU(1," Unit price must be a positive number "),e.qZA())}function U(n,s){if(1&n&&(e.TgZ(0,"ion-select-option",26),e._uU(1),e.qZA()),2&n){const o=s.$implicit;e.Q6J("value",o.id),e.xp6(1),e.hij(" ",o.name," ")}}function z(n,s){1&n&&(e.TgZ(0,"ion-note",25),e._uU(1," Please select a category "),e.qZA())}function q(n,s){1&n&&(e.TgZ(0,"ion-note",25),e._uU(1," Stock amount must be a positive number "),e.qZA())}const E=[{path:"",component:(()=>{class n{constructor(o,t,r,a,d,l,u,c){this.fb=o,this.loadingCtrl=t,this.toastCtrl=r,this._user=a,this.navCtrl=d,this._product=l,this._global=u,this.actionSheetController=c,this.imagePreview=null,this.subscriptions=new I.w0,this.categories=[],this.MAX_FILE_SIZE=47185920,this.initializeForm(),this.categories=this._product.getCategories()}initializeForm(){this.productForm=this.fb.group({name:["",[m.kI.required,m.kI.minLength(3),m.kI.maxLength(100)]],barcode:["",[m.kI.maxLength(50)]],categoryId:["",[m.kI.required]],image:[""],stockAmount:[0,[]]})}goBack(){this.navCtrl.back()}presentImageSourceActionSheet(){var o=this;return(0,v.Z)(function*(){yield(yield o.actionSheetController.create({header:"Select Image Source",buttons:[{text:"Camera",icon:"camera",handler:()=>{o.takePicture(_.oK.Camera)}},{text:"File",icon:"folder",handler:()=>{const r=document.querySelector('input[type="file"]');r&&r.click()}},{text:"Cancel",icon:"close",role:"cancel"}]})).present()})()}takePicture(o){var t=this;return(0,v.Z)(function*(){try{const r=yield _.V1.getPhoto({quality:90,allowEditing:!1,resultType:_.dk.Base64,source:o,correctOrientation:!0,width:500,height:500});if(r.base64String){const a=`data:image/jpeg;base64,${r.base64String}`;if(t.getBase64Size(a)>t.MAX_FILE_SIZE)return void(yield(yield t.toastCtrl.create({message:"Image size must be less than or equal to 45MB.",duration:2e3,color:"danger"})).present());try{const l=yield t.compressImage(a);t.imagePreview=l,t.productForm.patchValue({image:l})}catch{yield(yield t.toastCtrl.create({message:"Failed to process image. Please try another image.",duration:2e3,color:"danger"})).present()}}}catch(r){console.error("Error taking picture",r),yield(yield t.toastCtrl.create({message:"Failed to get image. Please try again.",duration:2e3,color:"danger"})).present()}})()}getBase64Size(o){const t=o.split(",")[1];return t?Math.ceil(3*t.length/4):0}getFileSize(o){return o.size}compressImage(o,t=700){var r=this;return(0,v.Z)(function*(){return r._global.setLoader(!0),new Promise((a,d)=>{let l,u=new Image;"string"==typeof o?u.src=o:(l=new FileReader,l.readAsDataURL(o),l.onload=c=>{var p;u.src=null===(p=c.target)||void 0===p?void 0:p.result},l.onerror=c=>d(c)),u.onload=()=>{const c=document.createElement("canvas"),p=c.getContext("2d");let b,f=.9,h=1;const P=()=>{if(c.width=u.width*h,c.height=u.height*h,null==p||p.drawImage(u,0,0,c.width,c.height),b=c.toDataURL("image/jpeg",f),b.length*(3/4)/1024>t){if(f>.1)f-=.1;else{if(!(h>.5))return void d(new Error("Cannot compress image to required size"));h-=.1,f=.9}P()}else a(b)};P(),r._global.setLoader(!1)},u.onerror=c=>d(c)})})()}onImageSelect(o){var t=this;return(0,v.Z)(function*(){const r=o.target.files[0];if(r){if(t.getFileSize(r)>t.MAX_FILE_SIZE)return void(yield(yield t.toastCtrl.create({message:"Image size must be less than or equal to 45MB.",duration:2e3,color:"danger"})).present());try{const a=yield t.compressImage(r);t.imagePreview=a,t.productForm.patchValue({image:a})}catch{yield(yield t.toastCtrl.create({message:"Failed to compress image. Please try another image.",duration:2e3,color:"danger"})).present()}}})()}onSubmit(){var o=this;return(0,v.Z)(function*(){if(o.productForm.valid){const y=yield o.loadingCtrl.create({message:"Adding product..."});yield y.present();try{var t,r,a,d,l,u,c,p,f,h,b,P;const C={name:null===(t=o.productForm.get("name"))||void 0===t||null===(r=t.value)||void 0===r?void 0:r.trim(),unitPrice:parseFloat(null===(a=o.productForm.get("unitPrice"))||void 0===a?void 0:a.value)||0,barcode:(null===(d=o.productForm.get("barcode"))||void 0===d||null===(l=d.value)||void 0===l?void 0:l.trim())||"",categoryId:parseInt(null===(u=o.productForm.get("categoryId"))||void 0===u?void 0:u.value),image:(null===(c=o.productForm.get("image"))||void 0===c?void 0:c.value)||"",stockAmount:parseInt(null===(p=o.productForm.get("stockAmount"))||void 0===p?void 0:p.value)||0,shortDescription:null===(f=o.productForm.get("shortDescription"))||void 0===f||null===(h=f.value)||void 0===h?void 0:h.trim(),longDescription:(null===(b=o.productForm.get("longDescription"))||void 0===b||null===(P=b.value)||void 0===P?void 0:P.trim())||"",createdDate:(new Date).toISOString(),lastUpdatedDate:(new Date).toISOString()};console.log("Form Data:",o.productForm.value),console.log("Processed Data:",C);const B=o._user.getnewproductadd(C).subscribe(A=>{console.log("API Response:",A),o.handleSuccess()},A=>{console.error("API Error:",A),o.handleError("Failed to add product. Please try again.")});o.subscriptions.add(B),yield y.dismiss()}catch(C){console.error("Unexpected Error:",C),yield y.dismiss(),o.handleError("An unexpected error occurred. Please try again.")}}else o.markFormGroupTouched(),o.handleError("Please fill in all required fields correctly.")})()}handleSuccess(){var o=this;return(0,v.Z)(function*(){yield(yield o.toastCtrl.create({message:"Product added successfully!",duration:2e3,color:"success"})).present(),setTimeout(()=>{o.navCtrl.navigateForward("/product")},2e3),o.resetForm()})()}handleError(o){var t=this;return(0,v.Z)(function*(){yield(yield t.toastCtrl.create({message:o,duration:3e3,color:"danger"})).present()})()}markFormGroupTouched(){Object.keys(this.productForm.controls).forEach(o=>{const t=this.productForm.get(o);null==t||t.markAsTouched()})}resetForm(){this.productForm.reset(),this.imagePreview=null,this.initializeForm()}isFieldInvalid(o){const t=this.productForm.get(o);return!!t&&t.invalid&&t.touched}getFieldErrorMessage(o){const t=this.productForm.get(o);return t&&t.errors?t.errors.required?"This field is required":t.errors.minlength?`Minimum length is ${t.errors.minlength.requiredLength} characters`:t.errors.maxlength?`Maximum length is ${t.errors.maxlength.requiredLength} characters`:t.errors.min?`Minimum value is ${t.errors.min.min}`:t.errors.pattern?"Invalid format":"Invalid input":""}}return n.\u0275fac=function(o){return new(o||n)(e.Y36(m.qu),e.Y36(i.HT),e.Y36(i.yF),e.Y36(Z.K),e.Y36(i.SH),e.Y36(O.M),e.Y36(S.U),e.Y36(i.BX))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-add-new-product"]],decls:48,vars:12,consts:[["slot","start"],["defaultHref","/product"],[2,"display","flex"],[1,"balaanz-logo"],["src","/assets/images/balaanz-logo.jpg"],[1,"ion-padding",3,"formGroup","ngSubmit"],[1,"image-upload-container"],[1,"image-preview"],[3,"src",4,"ngIf"],["name","image-outline",4,"ngIf"],["type","file","accept","image/*","hidden","",3,"change"],["fileInput",""],["fill","clear","expand","block",3,"click"],["position","stacked"],["formControlName","name","placeholder","Enter product name"],["slot","error",4,"ngIf"],["type","number","formControlName","unitPrice","placeholder","Enter unit price","min","0","step","0.01"],["formControlName","barcode","placeholder","Enter barcode"],["formControlName","categoryId","placeholder","Select category"],[3,"value",4,"ngFor","ngForOf"],["type","number","formControlName","stockAmount","placeholder","Enter stock amount","min","0"],[1,"submit-button"],["expand","block","type","submit",3,"disabled"],[3,"src"],["name","image-outline"],["slot","error"],[3,"value"]],template:function(o,t){if(1&o&&(e.TgZ(0,"div")(1,"ion-toolbar")(2,"ion-buttons",0),e._UZ(3,"ion-back-button",1),e.qZA(),e.TgZ(4,"div",2)(5,"ion-title"),e._uU(6,"Add New Product"),e.qZA(),e.TgZ(7,"span",3),e._UZ(8,"img",4),e.qZA()()()(),e.TgZ(9,"ion-content")(10,"form",5),e.NdJ("ngSubmit",function(){return t.onSubmit()}),e.TgZ(11,"div",6)(12,"div",7),e.YNc(13,N,1,1,"img",8),e.YNc(14,T,1,0,"ion-icon",9),e.TgZ(15,"input",10,11),e.NdJ("change",function(a){return t.onImageSelect(a)}),e.qZA(),e.TgZ(17,"ion-button",12),e.NdJ("click",function(){return t.presentImageSourceActionSheet()}),e._uU(18),e.qZA()()(),e.TgZ(19,"ion-list")(20,"ion-item")(21,"ion-label",13),e._uU(22,"Product Name"),e.qZA(),e._UZ(23,"ion-input",14),e.YNc(24,F,2,0,"ion-note",15),e.qZA(),e.TgZ(25,"ion-item")(26,"ion-label",13),e._uU(27,"Unit Price"),e.qZA(),e._UZ(28,"ion-input",16),e.YNc(29,k,2,0,"ion-note",15),e.qZA(),e.TgZ(30,"ion-item")(31,"ion-label",13),e._uU(32,"Barcode"),e.qZA(),e._UZ(33,"ion-input",17),e.qZA(),e.TgZ(34,"ion-item")(35,"ion-label",13),e._uU(36,"Category"),e.qZA(),e.TgZ(37,"ion-select",18),e.YNc(38,U,2,2,"ion-select-option",19),e.qZA(),e.YNc(39,z,2,0,"ion-note",15),e.qZA(),e.TgZ(40,"ion-item")(41,"ion-label",13),e._uU(42,"Stock Amount"),e.qZA(),e._UZ(43,"ion-input",20),e.YNc(44,q,2,0,"ion-note",15),e.qZA()(),e.TgZ(45,"div",21)(46,"ion-button",22),e._uU(47," Add Product "),e.qZA()()()()),2&o){let r,a,d,l;e.xp6(10),e.Q6J("formGroup",t.productForm),e.xp6(2),e.ekj("has-image",t.imagePreview),e.xp6(1),e.Q6J("ngIf",t.imagePreview),e.xp6(1),e.Q6J("ngIf",!t.imagePreview),e.xp6(4),e.hij(" ",t.imagePreview?"Change Image":"Upload Image"," "),e.xp6(6),e.Q6J("ngIf",(null==(r=t.productForm.get("name"))?null:r.invalid)&&(null==(r=t.productForm.get("name"))?null:r.touched)),e.xp6(5),e.Q6J("ngIf",(null==(a=t.productForm.get("unitPrice"))?null:a.invalid)&&(null==(a=t.productForm.get("unitPrice"))?null:a.touched)),e.xp6(9),e.Q6J("ngForOf",t.categories),e.xp6(1),e.Q6J("ngIf",(null==(d=t.productForm.get("categoryId"))?null:d.invalid)&&(null==(d=t.productForm.get("categoryId"))?null:d.touched)),e.xp6(5),e.Q6J("ngIf",(null==(l=t.productForm.get("stockAmount"))?null:l.invalid)&&(null==(l=t.productForm.get("stockAmount"))?null:l.touched)),e.xp6(2),e.Q6J("disabled",!t.productForm.valid)}},dependencies:[x.sg,x.O5,i.oU,i.YG,i.Sm,i.W2,i.gu,i.pK,i.Ie,i.Q$,i.q_,i.uN,i.t9,i.n0,i.wd,i.sr,i.as,i.QI,i.j9,i.cs,m._Y,m.JJ,m.JL,m.sg,m.u],styles:['.balaanz-logo[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;align-items:center;height:30px}.balaanz-logo[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:40px;width:40px;border-radius:80%;object-fit:cover;margin-left:10px}.image-upload-container[_ngcontent-%COMP%]{display:flex;justify-content:center;margin-bottom:20px}.image-preview[_ngcontent-%COMP%]{width:200px;height:200px;border:2px dashed #ccc;border-radius:8px;display:flex;flex-direction:column;align-items:center;justify-content:center;position:relative;background-color:#f8f9fa;transition:border-color .3s ease}.image-preview.has-image[_ngcontent-%COMP%]{border-color:#3880ff;background-color:#fff}.image-preview[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;border-radius:6px}.image-preview[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:48px;color:#999;margin-bottom:10px}.image-preview[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{margin-top:10px;--color: #3880ff;--border-color: #3880ff}ion-list[_ngcontent-%COMP%]{margin-bottom:20px}ion-item[_ngcontent-%COMP%]{--padding-start: 0;--padding-end: 0;--inner-padding-end: 0;margin-bottom:16px;border-radius:8px;--border-radius: 8px;--background: #f8f9fa;--border-color: #e9ecef}ion-item.item-has-focus[_ngcontent-%COMP%]{--background: #fff;--border-color: #3880ff;box-shadow:0 0 0 2px #3880ff33}ion-item.item-has-error[_ngcontent-%COMP%]{--border-color: #eb445a;--background: #fff5f5}ion-label[_ngcontent-%COMP%]{font-weight:600;color:#2c3e50;margin-bottom:8px}ion-input[_ngcontent-%COMP%], ion-select[_ngcontent-%COMP%], ion-textarea[_ngcontent-%COMP%]{--padding-start: 12px;--padding-end: 12px;--padding-top: 12px;--padding-bottom: 12px;--background: #fff;--border-radius: 6px;--border: 1px solid #e9ecef;margin-top:8px}ion-input.ion-invalid[_ngcontent-%COMP%], ion-select.ion-invalid[_ngcontent-%COMP%], ion-textarea.ion-invalid[_ngcontent-%COMP%]{--border-color: #eb445a}ion-input.ion-valid[_ngcontent-%COMP%], ion-select.ion-valid[_ngcontent-%COMP%], ion-textarea.ion-valid[_ngcontent-%COMP%]{--border-color: #2dd36f}ion-textarea[_ngcontent-%COMP%]{--min-height: 80px;--max-height: 120px}ion-note[_ngcontent-%COMP%]{font-size:12px;margin-top:4px}ion-note[slot=error][_ngcontent-%COMP%]{color:#eb445a;font-weight:500}ion-note[slot=helper][_ngcontent-%COMP%]{color:#6c757d;font-style:italic}.submit-button[_ngcontent-%COMP%]{margin-top:30px;margin-bottom:20px}.submit-button[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{--border-radius: 8px;--padding-top: 16px;--padding-bottom: 16px;font-weight:600;font-size:16px}.submit-button[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]:disabled{--opacity: .6}@media (max-width: 576px){.image-preview[_ngcontent-%COMP%]{width:150px;height:150px}ion-item[_ngcontent-%COMP%]{margin-bottom:12px}.submit-button[_ngcontent-%COMP%]{margin-top:20px}}.form-error[_ngcontent-%COMP%]{color:#eb445a;font-size:12px;margin-top:4px;font-weight:500}.form-helper[_ngcontent-%COMP%]{color:#6c757d;font-size:12px;margin-top:4px;font-style:italic}ion-label[for=name][_ngcontent-%COMP%]:after, ion-label[for=unitPrice][_ngcontent-%COMP%]:after, ion-label[for=categoryId][_ngcontent-%COMP%]:after, ion-label[for=stockAmount][_ngcontent-%COMP%]:after, ion-label[for=shortDescription][_ngcontent-%COMP%]:after{content:" *";color:#eb445a;font-weight:700}ion-item[_ngcontent-%COMP%]:nth-child(1)   ion-label[_ngcontent-%COMP%]:after, ion-item[_ngcontent-%COMP%]:nth-child(4)   ion-label[_ngcontent-%COMP%]:after{content:" *";color:#eb445a;font-weight:700}']}),n})()}];let J=(()=>{class n{}return n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[w.Bz.forChild(E),w.Bz]}),n})(),Y=(()=>{class n{}return n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[x.ez,J,i.Pc,m.UX]}),n})()}}]);