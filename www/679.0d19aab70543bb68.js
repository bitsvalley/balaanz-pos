"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[679],{679:(z,b,c)=>{c.r(b),c.d(b,{AddNewProductModule:()=>T});var C=c(6814),w=c(3057),h=c(5861),l=c(95),_=c(7394),v=c(8162),e=c(6689),r=c(5548),A=c(4695),I=c(7942),O=c(5821);function S(n,g){if(1&n&&e._UZ(0,"img",17),2&n){const t=e.oxw();e.Q6J("src",t.imagePreview,e.LSH)}}function Z(n,g){1&n&&e._UZ(0,"ion-icon",18)}function x(n,g){if(1&n&&(e.TgZ(0,"ion-select-option",19),e._uU(1),e.qZA()),2&n){const t=g.$implicit;e.Q6J("value",t.id),e.xp6(1),e.hij(" ",t.name," ")}}const N=[{path:"",component:(()=>{class n{constructor(t,o,i,a,m,d,u,s){this.fb=t,this.loadingCtrl=o,this.toastCtrl=i,this._user=a,this.navCtrl=m,this._product=d,this._global=u,this.actionSheetController=s,this.imagePreview=null,this.subscriptions=new _.w0,this.categories=[],this.MAX_FILE_SIZE=47185920,this.productForm=this.fb.group({name:["",[l.kI.required,l.kI.minLength(3)]],unitPrice:[0],barcode:[""],categoryId:["",l.kI.required],image:[""],stockAmount:[0],shortDescription:[""],longDescription:[""]}),this.categories=this._product.getCategories()}presentImageSourceActionSheet(){var t=this;return(0,h.Z)(function*(){yield(yield t.actionSheetController.create({header:"Select Image Source",buttons:[{text:"Camera",icon:"camera",handler:()=>{t.takePicture(v.oK.Camera)}},{text:"File",icon:"folder",handler:()=>{const i=document.querySelector('input[type="file"]');i&&i.click()}},{text:"Cancel",icon:"close",role:"cancel"}]})).present()})()}takePicture(t){var o=this;return(0,h.Z)(function*(){try{const i=yield v.V1.getPhoto({quality:90,allowEditing:!1,resultType:v.dk.Base64,source:t,correctOrientation:!0,width:500,height:500});if(i.base64String){const a=`data:image/jpeg;base64,${i.base64String}`;if(o.getBase64Size(a)>o.MAX_FILE_SIZE)return void(yield(yield o.toastCtrl.create({message:"Image size must be less than or equal to 45MB.",duration:2e3,color:"danger"})).present());try{const d=yield o.compressImage(a);o.imagePreview=d,o.productForm.patchValue({image:d})}catch{yield(yield o.toastCtrl.create({message:"Failed to process image. Please try another image.",duration:2e3,color:"danger"})).present()}}}catch(i){console.error("Error taking picture",i),yield(yield o.toastCtrl.create({message:"Failed to get image. Please try again.",duration:2e3,color:"danger"})).present()}})()}getBase64Size(t){const o=t.split(",")[1];return o?Math.ceil(3*o.length/4):0}getFileSize(t){return t.size}compressImage(t,o=700){var i=this;return(0,h.Z)(function*(){return i._global.setLoader(!0),new Promise((a,m)=>{let d,u=new Image;"string"==typeof t?u.src=t:(d=new FileReader,d.readAsDataURL(t),d.onload=s=>{var p;u.src=null===(p=s.target)||void 0===p?void 0:p.result},d.onerror=s=>m(s)),u.onload=()=>{const s=document.createElement("canvas"),p=s.getContext("2d");let y,f=.9,P=1;const M=()=>{if(s.width=u.width*P,s.height=u.height*P,null==p||p.drawImage(u,0,0,s.width,s.height),y=s.toDataURL("image/jpeg",f),y.length*(3/4)/1024>o){if(f>.1)f-=.1;else{if(!(P>.5))return void m(new Error("Cannot compress image to required size"));P-=.1,f=.9}M()}else a(y)};M(),i._global.setLoader(!1)},u.onerror=s=>m(s)})})()}onImageSelect(t){var o=this;return(0,h.Z)(function*(){const i=t.target.files[0];if(i){if(o.getFileSize(i)>o.MAX_FILE_SIZE)return void(yield(yield o.toastCtrl.create({message:"Image size must be less than or equal to 45MB.",duration:2e3,color:"danger"})).present());try{const a=yield o.compressImage(i);o.imagePreview=a,o.productForm.patchValue({image:a})}catch{yield(yield o.toastCtrl.create({message:"Failed to compress image. Please try another image.",duration:2e3,color:"danger"})).present()}}})()}onSubmit(){var t=this;return(0,h.Z)(function*(){if(t.productForm.valid){const o=yield t.loadingCtrl.create({message:"Adding product..."});yield o.present(),console.log(t.productForm.value);try{const i={...t.productForm.value,createdDate:(new Date).toISOString(),lastUpdatedDate:(new Date).toISOString()};console.log(i);const a=t._user.getnewproductadd(i).subscribe(d=>{console.log(d)});t.subscriptions.add(a),yield o.dismiss(),yield(yield t.toastCtrl.create({message:"Product added successfully!",duration:2e3,color:"success"})).present(),setTimeout(()=>{t.navCtrl.navigateForward("/product")},2e3),t.productForm.reset(),t.imagePreview=null}catch{yield o.dismiss(),yield(yield t.toastCtrl.create({message:"Failed to add product. Please try again.",duration:2e3,color:"danger"})).present()}}else yield(yield t.toastCtrl.create({message:"Please fill in all required fields correctly.",duration:2e3,color:"warning"})).present()})()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(l.qu),e.Y36(r.HT),e.Y36(r.yF),e.Y36(A.K),e.Y36(r.SH),e.Y36(I.M),e.Y36(O.U),e.Y36(r.BX))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-add-new-product"]],decls:33,vars:7,consts:[["slot","start"],["defaultHref","/products"],[1,"ion-padding",3,"formGroup","ngSubmit"],[1,"image-upload-container"],[1,"image-preview"],[3,"src",4,"ngIf"],["name","image-outline",4,"ngIf"],["type","file","accept","image/*","hidden","",3,"change"],["fileInput",""],["fill","clear","expand","block",3,"click"],["position","stacked"],["formControlName","name","placeholder","Enter product name"],["formControlName","barcode","placeholder","Enter barcode"],["formControlName","categoryId","placeholder","Select category"],[3,"value",4,"ngFor","ngForOf"],[1,"submit-button"],["expand","block","type","submit"],[3,"src"],["name","image-outline"],[3,"value"]],template:function(t,o){1&t&&(e.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),e._UZ(3,"ion-back-button",1),e.qZA(),e.TgZ(4,"ion-title"),e._uU(5,"Add New Product"),e.qZA()()(),e.TgZ(6,"ion-content")(7,"form",2),e.NdJ("ngSubmit",function(){return o.onSubmit()}),e.TgZ(8,"div",3)(9,"div",4),e.YNc(10,S,1,1,"img",5),e.YNc(11,Z,1,0,"ion-icon",6),e.TgZ(12,"input",7,8),e.NdJ("change",function(a){return o.onImageSelect(a)}),e.qZA(),e.TgZ(14,"ion-button",9),e.NdJ("click",function(){return o.presentImageSourceActionSheet()}),e._uU(15),e.qZA()()(),e.TgZ(16,"ion-list")(17,"ion-item")(18,"ion-label",10),e._uU(19,"Product Name*"),e.qZA(),e._UZ(20,"ion-input",11),e.qZA(),e.TgZ(21,"ion-item")(22,"ion-label",10),e._uU(23,"Barcode"),e.qZA(),e._UZ(24,"ion-input",12),e.qZA(),e.TgZ(25,"ion-item")(26,"ion-label",10),e._uU(27,"Category*"),e.qZA(),e.TgZ(28,"ion-select",13),e.YNc(29,x,2,2,"ion-select-option",14),e.qZA()()(),e.TgZ(30,"div",15)(31,"ion-button",16),e._uU(32," Add Product "),e.qZA()()()()),2&t&&(e.xp6(7),e.Q6J("formGroup",o.productForm),e.xp6(2),e.ekj("has-image",o.imagePreview),e.xp6(1),e.Q6J("ngIf",o.imagePreview),e.xp6(1),e.Q6J("ngIf",!o.imagePreview),e.xp6(4),e.hij(" ",o.imagePreview?"Change Image":"Upload Image"," "),e.xp6(14),e.Q6J("ngForOf",o.categories))},dependencies:[C.sg,C.O5,r.oU,r.YG,r.Sm,r.W2,r.Gu,r.gu,r.pK,r.Ie,r.Q$,r.q_,r.t9,r.n0,r.wd,r.sr,r.QI,r.j9,r.cs,l._Y,l.JJ,l.JL,l.sg,l.u],styles:[".image-upload-container[_ngcontent-%COMP%]{display:flex;justify-content:center;margin:20px 0}.image-upload-container[_ngcontent-%COMP%]   .image-preview[_ngcontent-%COMP%]{width:200px;height:200px;border:2px dashed var(--ion-color-medium);border-radius:12px;display:flex;flex-direction:column;align-items:center;justify-content:center;overflow:hidden;position:relative;background:var(--ion-color-light)}.image-upload-container[_ngcontent-%COMP%]   .image-preview.has-image[_ngcontent-%COMP%]{border-style:solid}.image-upload-container[_ngcontent-%COMP%]   .image-preview[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.image-upload-container[_ngcontent-%COMP%]   .image-preview[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:48px;color:var(--ion-color-medium)}.image-upload-container[_ngcontent-%COMP%]   .image-preview[_ngcontent-%COMP%]   input[type=file][_ngcontent-%COMP%]{display:none}.image-upload-container[_ngcontent-%COMP%]   .image-preview[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{position:absolute;bottom:8px;background:rgba(var(--ion-color-light-rgb),.9);border-radius:20px;font-size:14px}ion-list[_ngcontent-%COMP%]{background:transparent;padding:0;margin:16px 0}ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--padding-start: 0;--border-color: var(--ion-color-light);margin-bottom:16px;--background: var(--ion-color-light);border-radius:8px}ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin-bottom:8px;color:var(--ion-color-dark);font-weight:500}ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%], ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-textarea[_ngcontent-%COMP%], ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-select[_ngcontent-%COMP%]{--padding-start: 16px;--background: var(--ion-color-light);border-radius:8px;font-size:16px}.submit-button[_ngcontent-%COMP%]{margin:24px 0}.submit-button[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{--border-radius: 8px;height:48px;font-weight:600;font-size:16px;margin:0}@media (min-width: 768px){form[_ngcontent-%COMP%]{max-width:600px;margin:0 auto}}"]}),n})()}];let F=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[w.Bz.forChild(N),w.Bz]}),n})(),T=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[C.ez,F,r.Pc,l.UX]}),n})()}}]);