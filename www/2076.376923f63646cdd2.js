"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2076],{2076:(F,v,c)=>{c.r(v),c.d(v,{EditProductModule:()=>z});var y=c(6814),M=c(3057),h=c(5861),d=c(95),_=c(7394),C=c(8162),t=c(6689),a=c(5548),x=c(4695),I=c(7942),S=c(5821);function w(n,m){if(1&n&&t._UZ(0,"img",18),2&n){const e=t.oxw();t.Q6J("src",e.imagePreview,t.LSH)}}function Z(n,m){1&n&&t._UZ(0,"ion-icon",19)}const E=[{path:"",component:(()=>{class n{constructor(e,o,i,r,u,l,g,s){this.fb=e,this.loadingCtrl=o,this.toastCtrl=i,this._user=r,this._productService=u,this.navCtrl=l,this._global=g,this.actionSheetController=s,this.imagePreview=null,this.subscriptions=new _.w0,this.MAX_FILE_SIZE=47185920}ngOnInit(){this.itemData=this._productService.getItemData(),this.formSetUp(),this.imagePreview=this.itemData.image1}formSetUp(){this.productForm=this.fb.group({name:[this.itemData.name,[d.kI.required,d.kI.minLength(3)]],barcode:[this.itemData.barcode,[d.kI.required,d.kI.min(0)]],image:[this.itemData.image1,""]})}presentImageSourceActionSheet(){var e=this;return(0,h.Z)(function*(){yield(yield e.actionSheetController.create({header:"Select Image Source",buttons:[{text:"Camera",icon:"camera",handler:()=>{e.takePicture(C.oK.Camera)}},{text:"File",icon:"folder",handler:()=>{const i=document.querySelector('input[type="file"]');i&&i.click()}},{text:"Cancel",icon:"close",role:"cancel"}]})).present()})()}takePicture(e){var o=this;return(0,h.Z)(function*(){try{const i=yield C.V1.getPhoto({quality:90,allowEditing:!1,resultType:C.dk.Base64,source:e,correctOrientation:!0,width:500,height:500});if(i.base64String){const r=`data:image/jpeg;base64,${i.base64String}`;if(o.getBase64Size(r)>o.MAX_FILE_SIZE)return void(yield(yield o.toastCtrl.create({message:"Image size must be less than or equal to 45MB.",duration:2e3,color:"danger"})).present());try{const l=yield o.compressImage(r);o.imagePreview=l,o.productForm.patchValue({image:l})}catch{yield(yield o.toastCtrl.create({message:"Failed to process image. Please try another image.",duration:2e3,color:"danger"})).present()}}}catch(i){console.error("Error taking picture",i),yield(yield o.toastCtrl.create({message:"Failed to get image. Please try again.",duration:2e3,color:"danger"})).present()}})()}getBase64Size(e){const o=e.split(",")[1];return o?Math.ceil(3*o.length/4):0}getFileSize(e){return e.size}compressImage(e,o=700){var i=this;return(0,h.Z)(function*(){return i._global.setLoader(!0),new Promise((r,u)=>{let l,g=new Image;"string"==typeof e?g.src=e:(l=new FileReader,l.readAsDataURL(e),l.onload=s=>{var p;g.src=null===(p=s.target)||void 0===p?void 0:p.result},l.onerror=s=>u(s)),g.onload=()=>{const s=document.createElement("canvas"),p=s.getContext("2d");let b,f=.9,P=1;const O=()=>{if(s.width=g.width*P,s.height=g.height*P,null==p||p.drawImage(g,0,0,s.width,s.height),b=s.toDataURL("image/jpeg",f),b.length*(3/4)/1024>o){if(f>.1)f-=.1;else{if(!(P>.5))return void u(new Error("Cannot compress image to required size"));P-=.1,f=.9}O()}else r(b)};O(),i._global.setLoader(!1)},g.onerror=s=>u(s)})})()}onImageSelect(e){var o=this;return(0,h.Z)(function*(){const i=e.target.files[0];if(i){if(o.getFileSize(i)>o.MAX_FILE_SIZE)return void(yield(yield o.toastCtrl.create({message:"Image size must be less than or equal to 45MB.",duration:2e3,color:"danger"})).present());try{const r=yield o.compressImage(i);o.imagePreview=r,o.productForm.patchValue({image:r})}catch{yield(yield o.toastCtrl.create({message:"Failed to compress image. Please try another image.",duration:2e3,color:"danger"})).present()}}})()}onSubmit(){var e=this;return(0,h.Z)(function*(){if(e.productForm.valid){const o=yield e.loadingCtrl.create({message:"Updating product..."});yield o.present();try{const i={...e.productForm.value,lastUpdatedDate:(new Date).toISOString(),createdDate:e.itemData.createdDate,id:e.itemData.id,categoryId:e.itemData.category,stockAmount:e.itemData.stockAmount,shortDescription:e.itemData.shortDescription,longDescription:e.itemData.longDescription,unitPrice:e.itemData.unitPrice},r=e._user.geteditproduct(i).subscribe(l=>{console.log(l)});e.subscriptions.add(r),yield o.dismiss(),yield(yield e.toastCtrl.create({message:"Product updated successfully!",duration:2e3,color:"success"})).present(),setTimeout(()=>{e.navCtrl.navigateForward("/product")},2e3)}catch{yield o.dismiss(),yield(yield e.toastCtrl.create({message:"Failed to update product. Please try again.",duration:2e3,color:"danger"})).present()}}else yield(yield e.toastCtrl.create({message:"Please fill in all required fields correctly.",duration:2e3,color:"warning"})).present()})()}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(d.qu),t.Y36(a.HT),t.Y36(a.yF),t.Y36(x.K),t.Y36(I.M),t.Y36(a.SH),t.Y36(S.U),t.Y36(a.BX))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-edit-product"]],decls:31,vars:7,consts:[["slot","start"],["defaultHref","/products"],[2,"display","flex"],[1,"balaanz-logo"],["src","/assets/images/balaanz-logo.jpg"],[1,"ion-padding",3,"formGroup","ngSubmit"],[1,"image-upload-container"],[1,"image-preview"],[3,"src",4,"ngIf"],["name","image-outline",4,"ngIf"],["type","file","accept","image/*","hidden","",3,"change"],["fileInput",""],["fill","clear","expand","block",3,"click"],["position","stacked"],["formControlName","name","placeholder","Enter product name"],["formControlName","barcode","placeholder","Enter barcode"],[1,"submit-button"],["expand","block","type","submit",3,"disabled"],[3,"src"],["name","image-outline"]],template:function(e,o){1&e&&(t.TgZ(0,"div")(1,"ion-toolbar")(2,"ion-buttons",0),t._UZ(3,"ion-back-button",1),t.qZA(),t.TgZ(4,"div",2)(5,"ion-title"),t._uU(6,"Edit Product"),t.qZA(),t.TgZ(7,"span",3),t._UZ(8,"img",4),t.qZA()()()(),t.TgZ(9,"ion-content")(10,"form",5),t.NdJ("ngSubmit",function(){return o.onSubmit()}),t.TgZ(11,"div",6)(12,"div",7),t.YNc(13,w,1,1,"img",8),t.YNc(14,Z,1,0,"ion-icon",9),t.TgZ(15,"input",10,11),t.NdJ("change",function(r){return o.onImageSelect(r)}),t.qZA(),t.TgZ(17,"ion-button",12),t.NdJ("click",function(){return o.presentImageSourceActionSheet()}),t._uU(18),t.qZA()()(),t.TgZ(19,"ion-list")(20,"ion-item")(21,"ion-label",13),t._uU(22,"Product Name*"),t.qZA(),t._UZ(23,"ion-input",14),t.qZA(),t.TgZ(24,"ion-item")(25,"ion-label",13),t._uU(26,"Barcode"),t.qZA(),t._UZ(27,"ion-input",15),t.qZA()(),t.TgZ(28,"div",16)(29,"ion-button",17),t._uU(30," Update Product "),t.qZA()()()()),2&e&&(t.xp6(10),t.Q6J("formGroup",o.productForm),t.xp6(2),t.ekj("has-image",o.imagePreview),t.xp6(1),t.Q6J("ngIf",o.imagePreview),t.xp6(1),t.Q6J("ngIf",!o.imagePreview),t.xp6(4),t.hij(" ",o.imagePreview?"Change Image":"Upload Image"," "),t.xp6(11),t.Q6J("disabled",!o.productForm.valid))},dependencies:[y.O5,a.oU,a.YG,a.Sm,a.W2,a.gu,a.pK,a.Ie,a.Q$,a.q_,a.wd,a.sr,a.j9,a.cs,d._Y,d.JJ,d.JL,d.sg,d.u],styles:[".balaanz-logo[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;align-items:center;height:30px}.balaanz-logo[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:30px;width:30px;border-radius:50%;object-fit:cover;margin-right:2px}.image-upload-container[_ngcontent-%COMP%]{display:flex;justify-content:center;margin:20px 0}.image-upload-container[_ngcontent-%COMP%]   .image-preview[_ngcontent-%COMP%]{width:200px;height:200px;border:2px dashed var(--ion-color-medium);border-radius:12px;display:flex;flex-direction:column;align-items:center;justify-content:center;overflow:hidden;position:relative;background:var(--ion-color-light)}.image-upload-container[_ngcontent-%COMP%]   .image-preview.has-image[_ngcontent-%COMP%]{border-style:solid}.image-upload-container[_ngcontent-%COMP%]   .image-preview[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.image-upload-container[_ngcontent-%COMP%]   .image-preview[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:48px;color:var(--ion-color-medium)}.image-upload-container[_ngcontent-%COMP%]   .image-preview[_ngcontent-%COMP%]   input[type=file][_ngcontent-%COMP%]{display:none}.image-upload-container[_ngcontent-%COMP%]   .image-preview[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{position:absolute;bottom:8px;background:rgba(var(--ion-color-light-rgb),.9);border-radius:20px;font-size:14px}ion-list[_ngcontent-%COMP%]{background:transparent;padding:0;margin:16px 0}ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--padding-start: 0;--border-color: var(--ion-color-light);margin-bottom:16px;--background: var(--ion-color-light);border-radius:8px}ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin-bottom:8px;color:var(--ion-color-dark);font-weight:500}ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%], ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-textarea[_ngcontent-%COMP%], ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-select[_ngcontent-%COMP%]{--padding-start: 16px;--background: var(--ion-color-light);border-radius:8px;font-size:16px}.submit-button[_ngcontent-%COMP%]{margin:24px 0}.submit-button[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{--border-radius: 8px;height:48px;font-weight:600;font-size:16px;margin:0}@media (min-width: 768px){form[_ngcontent-%COMP%]{max-width:600px;margin:0 auto}}"]}),n})()}];let D=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[M.Bz.forChild(E),M.Bz]}),n})(),z=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[y.ez,D,a.Pc,d.UX]}),n})()}}]);