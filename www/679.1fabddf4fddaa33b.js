"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[679],{679:(J,_,c)=>{c.r(_),c.d(_,{AddNewProductModule:()=>z});var C=c(6814),y=c(3057),f=c(5861),d=c(95),A=c(7394),t=c(6689),i=c(5548),x=c(4695),Z=c(7942),N=c(5821);function I(o,l){if(1&o&&t._UZ(0,"img",17),2&o){const e=t.oxw();t.Q6J("src",e.imagePreview,t.LSH)}}function S(o,l){1&o&&t._UZ(0,"ion-icon",18)}function T(o,l){if(1&o&&(t.TgZ(0,"ion-select-option",19),t._uU(1),t.qZA()),2&o){const e=l.$implicit;t.Q6J("value",e.id),t.xp6(1),t.hij(" ",e.name," ")}}const U=[{path:"",component:(()=>{class o{constructor(e,n,a,r,s,g,u){this.fb=e,this.loadingCtrl=n,this.toastCtrl=a,this._user=r,this.navCtrl=s,this._product=g,this._global=u,this.imagePreview=null,this.subscriptions=new A.w0,this.categories=[],this.productForm=this.fb.group({name:["",[d.kI.required,d.kI.minLength(3)]],unitPrice:[0],barcode:[""],categoryId:["",d.kI.required],image:[""],stockAmount:[0],shortDescription:[""],longDescription:[""]}),this.categories=this._product.getCategories()}compressImage(e,n=700){var a=this;return(0,f.Z)(function*(){return a._global.setLoader(!0),new Promise((r,s)=>{const g=new FileReader;g.readAsDataURL(e),g.onload=function(){var u=(0,f.Z)(function*(M){var v;const p=new Image;p.src=null===(v=M.target)||void 0===v?void 0:v.result,p.onload=()=>{const m=document.createElement("canvas"),b=m.getContext("2d");let w,h=.9,P=1;const O=()=>{if(m.width=p.width*P,m.height=p.height*P,null==b||b.drawImage(p,0,0,m.width,m.height),w=m.toDataURL("image/jpeg",h),w.length*(3/4)/1024>n){if(h>.1)h-=.1;else{if(!(P>.5))return void s(new Error("Cannot compress image to required size"));P-=.1,h=.9}O()}else r(w)};O(),a._global.setLoader(!1)}});return function(M){return u.apply(this,arguments)}}(),g.onerror=u=>s(u)})})()}onImageSelect(e){var n=this;return(0,f.Z)(function*(){const a=e.target.files[0];if(a)try{const r=yield n.compressImage(a);if(r.length*(3/4)/1024>700)return void(yield(yield n.toastCtrl.create({message:"Image size must be less than or equal to 700 KB.",duration:2e3,color:"danger"})).present());n.imagePreview=r,n.productForm.patchValue({image:r})}catch{yield(yield n.toastCtrl.create({message:"Failed to compress image. Please try another image.",duration:2e3,color:"danger"})).present()}})()}onSubmit(){var e=this;return(0,f.Z)(function*(){if(e.productForm.valid){const n=yield e.loadingCtrl.create({message:"Adding product..."});yield n.present(),console.log(e.productForm.value);try{const a={...e.productForm.value,createdDate:(new Date).toISOString(),lastUpdatedDate:(new Date).toISOString()};console.log(a);const r=e._user.getnewproductadd(a).subscribe(g=>{console.log(g)});e.subscriptions.add(r),yield n.dismiss(),yield(yield e.toastCtrl.create({message:"Product added successfully!",duration:2e3,color:"success"})).present(),setTimeout(()=>{e.navCtrl.navigateForward("/product")},2e3),e.productForm.reset(),e.imagePreview=null}catch{yield n.dismiss(),yield(yield e.toastCtrl.create({message:"Failed to add product. Please try again.",duration:2e3,color:"danger"})).present()}}else yield(yield e.toastCtrl.create({message:"Please fill in all required fields correctly.",duration:2e3,color:"warning"})).present()})()}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(d.qu),t.Y36(i.HT),t.Y36(i.yF),t.Y36(x.K),t.Y36(i.SH),t.Y36(Z.M),t.Y36(N.U))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-add-new-product"]],decls:33,vars:7,consts:[["slot","start"],["defaultHref","/products"],[1,"ion-padding",3,"formGroup","ngSubmit"],[1,"image-upload-container"],[1,"image-preview"],[3,"src",4,"ngIf"],["name","image-outline",4,"ngIf"],["type","file","accept","image/*","hidden","",3,"change"],["fileInput",""],["fill","clear","expand","block",3,"click"],["position","stacked"],["formControlName","name","placeholder","Enter product name"],["formControlName","barcode","placeholder","Enter barcode"],["formControlName","categoryId","placeholder","Select category"],[3,"value",4,"ngFor","ngForOf"],[1,"submit-button"],["expand","block","type","submit"],[3,"src"],["name","image-outline"],[3,"value"]],template:function(e,n){if(1&e){const a=t.EpF();t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),t._UZ(3,"ion-back-button",1),t.qZA(),t.TgZ(4,"ion-title"),t._uU(5,"Add New Product"),t.qZA()()(),t.TgZ(6,"ion-content")(7,"form",2),t.NdJ("ngSubmit",function(){return n.onSubmit()}),t.TgZ(8,"div",3)(9,"div",4),t.YNc(10,I,1,1,"img",5),t.YNc(11,S,1,0,"ion-icon",6),t.TgZ(12,"input",7,8),t.NdJ("change",function(s){return n.onImageSelect(s)}),t.qZA(),t.TgZ(14,"ion-button",9),t.NdJ("click",function(){t.CHM(a);const s=t.MAs(13);return t.KtG(s.click())}),t._uU(15),t.qZA()()(),t.TgZ(16,"ion-list")(17,"ion-item")(18,"ion-label",10),t._uU(19,"Product Name*"),t.qZA(),t._UZ(20,"ion-input",11),t.qZA(),t.TgZ(21,"ion-item")(22,"ion-label",10),t._uU(23,"Barcode"),t.qZA(),t._UZ(24,"ion-input",12),t.qZA(),t.TgZ(25,"ion-item")(26,"ion-label",10),t._uU(27,"Category*"),t.qZA(),t.TgZ(28,"ion-select",13),t.YNc(29,T,2,2,"ion-select-option",14),t.qZA()()(),t.TgZ(30,"div",15)(31,"ion-button",16),t._uU(32," Add Product "),t.qZA()()()()}2&e&&(t.xp6(7),t.Q6J("formGroup",n.productForm),t.xp6(2),t.ekj("has-image",n.imagePreview),t.xp6(1),t.Q6J("ngIf",n.imagePreview),t.xp6(1),t.Q6J("ngIf",!n.imagePreview),t.xp6(4),t.hij(" ",n.imagePreview?"Change Image":"Upload Image"," "),t.xp6(14),t.Q6J("ngForOf",n.categories))},dependencies:[C.sg,C.O5,i.oU,i.YG,i.Sm,i.W2,i.Gu,i.gu,i.pK,i.Ie,i.Q$,i.q_,i.t9,i.n0,i.wd,i.sr,i.QI,i.j9,i.cs,d._Y,d.JJ,d.JL,d.sg,d.u],styles:[".image-upload-container[_ngcontent-%COMP%]{display:flex;justify-content:center;margin:20px 0}.image-upload-container[_ngcontent-%COMP%]   .image-preview[_ngcontent-%COMP%]{width:200px;height:200px;border:2px dashed var(--ion-color-medium);border-radius:12px;display:flex;flex-direction:column;align-items:center;justify-content:center;overflow:hidden;position:relative;background:var(--ion-color-light)}.image-upload-container[_ngcontent-%COMP%]   .image-preview.has-image[_ngcontent-%COMP%]{border-style:solid}.image-upload-container[_ngcontent-%COMP%]   .image-preview[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.image-upload-container[_ngcontent-%COMP%]   .image-preview[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:48px;color:var(--ion-color-medium)}.image-upload-container[_ngcontent-%COMP%]   .image-preview[_ngcontent-%COMP%]   input[type=file][_ngcontent-%COMP%]{display:none}.image-upload-container[_ngcontent-%COMP%]   .image-preview[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{position:absolute;bottom:8px;background:rgba(var(--ion-color-light-rgb),.9);border-radius:20px;font-size:14px}ion-list[_ngcontent-%COMP%]{background:transparent;padding:0;margin:16px 0}ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--padding-start: 0;--border-color: var(--ion-color-light);margin-bottom:16px;--background: var(--ion-color-light);border-radius:8px}ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin-bottom:8px;color:var(--ion-color-dark);font-weight:500}ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%], ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-textarea[_ngcontent-%COMP%], ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   ion-select[_ngcontent-%COMP%]{--padding-start: 16px;--background: var(--ion-color-light);border-radius:8px;font-size:16px}.submit-button[_ngcontent-%COMP%]{margin:24px 0}.submit-button[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{--border-radius: 8px;height:48px;font-weight:600;font-size:16px;margin:0}@media (min-width: 768px){form[_ngcontent-%COMP%]{max-width:600px;margin:0 auto}}"]}),o})()}];let F=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[y.Bz.forChild(U),y.Bz]}),o})(),z=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[C.ez,F,i.Pc,d.UX]}),o})()}}]);